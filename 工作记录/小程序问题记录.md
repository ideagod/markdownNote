# 小程序

## 原生

1.拉下后构建npm，npm i；

catchtouchmove阻止事件冒泡

位置权限问题：

### 1.开启定位权限

```js
wx.getSetting({
          success(res) {
            //地理位置
            if (!res.authSetting['scope.userLocation']) {
              wx.authorize({
                scope: 'scope.userLocation',
                success(res) {
                  // getWifiList();
                  console.log('scope.userLocation',res)
                },
                fail(res) {
                  wx.showModal({
                    title: '提示',
                    content: '定位失败，您未开启定位权限，点击开启定位权限',
                    success: function (res) {
                      if (res.confirm) {
                        wx.openSetting({
                          success: function (res) {
                            if (res.authSetting['scope.userLocation']) {
                              // getWifiList();
                              console.log('authSetting'.res)
                            } else {
                              wx.showToast({
                                title: '用户未开启地理位置权限',
                                icon: "none",
                                duration: 3000
                              })
                            }
                          }
                        })
                      }
                    }
                  })
                }
              })
            } else {
              // getWifiList();
            }
          }
        })
```

需在app.json内设置

```json
"permission": {
    "scope.userLocation": {
        "desc": "你的位置信息将用于获取附近WiFi"
    }
  }
```

### 2.函数防抖

```js
let debounceTimer;

// 防抖
  debounce(func, wait) {
    return () => {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(func, wait);
    };
  },

// 调用方法
   addFeedbackInfoBtn(e) {
    this.debounce(() => {
      this.addFeedbackInfoBtnFun(e)
    }, 300)()
  },
```

### 3.图片，视频提交

微信小程序上传文件只能用wx.uploadFile

```js
let util = require('../../../utils/util.js');
wx.uploadFile({
        url: util.XXX_HOST_URL + 'xx云路径',
        filePath: urls[i],
        name: 'file',
        header: {
          "Content-Type": "multipart/form-data"
        },
        formData: {
          file: urls[i],
        },
        success(res) {
          resUrls[i] = JSON.parse(res.data).result;

          //！若三个都有才执行方法，array.prototype.every	
          if (resUrls.every(item => item)) {	
            that.addFeedback(urlTypes, resUrls);
          }
        }
      })
```

### 4.分页，下拉刷新

```js
  // 下拉刷新
  onReachBottom: function () {
    this.data.reachBtn ? this.getHistoryPage(): ''
  }, 

util.appRequest({
      method: 'post',
      url: '/page?limit=' + this.data.limit + '&page=' + this.data.page,
      data: data,
      success: (res) => {
        if (res.result.length != 0) {
          // 分页
          let page = that.data.page;
          let newPage = page + 1;
          that.setData({
            page: newPage
          })
            
            
          // 存储数据
          let hisData = that.data.historyData;
          hisData = hisData.concat(res.result);	//使用了concat将两个数组合并
          that.setData({
            historyData: hisData
          })
        } else {
          that.setData({
            reachBtn: false
          })
        }
          
          
      }
    });
```

### 5.电话号码校验

第一位是1

```js
// 电话号码校验
  mobileInput(e) {
    let value = e.detail.value.replace(/\D/g, '')
    this.setData({
      phone: value,
    })
    var myreg = /^1\d{10}$/;
    if (this.data.phone.length === 0) {
      this.setData({
        mobileFormat: true,
      })
      return false;
    }
    if (this.data.phone.length < 11) {
      this.setData({
        mobileFormat: false,
      })
    } else if (!myreg.test(this.data.phone)) {
      this.setData({
        mobileFormat: false,
      })
    } else {
      this.setData({
        mobileFormat: true,
      })
    }
  },
```



## uni-app
